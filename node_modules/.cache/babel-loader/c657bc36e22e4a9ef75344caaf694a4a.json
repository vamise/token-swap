{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"/Users/mikovainio/FyFy/token-swap/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\n\nvar _createClass = require(\"/Users/mikovainio/FyFy/token-swap/node_modules/@babel/runtime/helpers/createClass.js\").default;\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.StablePoolQuoteBuilder = void 0;\n\nvar spl_token_1 = require(\"@solana/spl-token\");\n\nvar decimal_js_1 = __importDefault(require(\"decimal.js\"));\n\nvar stablecurve_1 = require(\"@orca-so/stablecurve\");\n\nvar public_1 = require(\"../../public\");\n\nvar tokens_1 = require(\"../../constants/tokens\");\n\nfunction getInputAmountLessFees(inputTradeAmount, params) {\n  return inputTradeAmount.sub(_getLPFees(inputTradeAmount, params));\n}\n\nfunction getOutputAmountWithNoSlippage(inputTradeAmountLessFees, params) {\n  var _ref = [params.inputTokenCount, params.outputTokenCount, params.amp],\n      poolInputAmount = _ref[0],\n      poolOutputAmount = _ref[1],\n      amp = _ref[2];\n  return (0, stablecurve_1.computeBaseOutputAmount)(inputTradeAmountLessFees, poolInputAmount, poolOutputAmount, amp);\n}\n\nfunction getOutputAmount(inputTradeAmountLessFees, params) {\n  var _ref2 = [params.inputTokenCount, params.outputTokenCount, params.amp],\n      poolInputAmount = _ref2[0],\n      poolOutputAmount = _ref2[1],\n      amp = _ref2[2];\n  return (0, stablecurve_1.computeOutputAmount)(inputTradeAmountLessFees, poolInputAmount, poolOutputAmount, amp);\n}\n\nfunction getExpectedOutputAmountWithNoSlippage(inputTradeAmount, params) {\n  var inputTradeAmountLessFees = getInputAmountLessFees(inputTradeAmount, params);\n  return getOutputAmountWithNoSlippage(inputTradeAmountLessFees, params);\n}\n\nfunction _getExpectedOutputAmount(inputTradeAmount, params) {\n  var inputTradeAmountLessFees = getInputAmountLessFees(inputTradeAmount, params);\n  return getOutputAmount(inputTradeAmountLessFees, params);\n}\n\nfunction _getRate(inputTradeAmountU64, params) {\n  if (inputTradeAmountU64.eq(public_1.ZERO)) {\n    return new decimal_js_1.default(0);\n  }\n\n  var expectedOutputAmountU64 = _getExpectedOutputAmount(inputTradeAmountU64, params);\n\n  var inputTradeAmount = public_1.DecimalUtil.fromU64(inputTradeAmountU64, params.inputToken.scale);\n  var outputTradeAmount = public_1.DecimalUtil.fromU64(expectedOutputAmountU64, params.outputToken.scale);\n  return outputTradeAmount.div(inputTradeAmount).toDecimalPlaces(params.outputToken.scale);\n}\n\nfunction _getPriceImpact(inputTradeAmount, params) {\n  if (inputTradeAmount.eq(public_1.ZERO) || params.inputTokenCount.eq(public_1.ZERO) || params.outputTokenCount.eq(public_1.ZERO)) {\n    return new decimal_js_1.default(0);\n  }\n\n  var noSlippageOutputCountU64 = getExpectedOutputAmountWithNoSlippage(inputTradeAmount, params);\n\n  var outputCountU64 = _getExpectedOutputAmount(inputTradeAmount, params);\n\n  var noSlippageOutputCount = public_1.DecimalUtil.fromU64(noSlippageOutputCountU64, params.outputToken.scale);\n  var outputCount = public_1.DecimalUtil.fromU64(outputCountU64, params.outputToken.scale);\n  var impact = noSlippageOutputCount.sub(outputCount).div(noSlippageOutputCount);\n  return impact.mul(100).toDecimalPlaces(params.outputToken.scale);\n}\n\nfunction _getLPFees(inputTradeAmount, params) {\n  var feeStructure = params.feeStructure;\n  var tradingFee = feeStructure.traderFee.numerator === public_1.ZERO ? public_1.ZERO : inputTradeAmount.mul(feeStructure.traderFee.numerator).div(feeStructure.traderFee.denominator);\n  var ownerFee = feeStructure.ownerFee.numerator === public_1.ZERO ? public_1.ZERO : inputTradeAmount.mul(feeStructure.ownerFee.numerator).div(feeStructure.ownerFee.denominator);\n  return new spl_token_1.u64(tradingFee.add(ownerFee).toString());\n}\n\nfunction getMinimumAmountOut(inputTradeAmount, params) {\n  var slippageTolerance = params.slippageTolerance;\n\n  var expectedOutputAmount = _getExpectedOutputAmount(inputTradeAmount, params);\n\n  return expectedOutputAmount.mul(slippageTolerance.denominator.sub(slippageTolerance.numerator)).div(slippageTolerance.denominator);\n}\n\nfunction _getNetworkFees(params) {\n  var numSigs;\n\n  if (params.inputToken === tokens_1.solToken || params.outputToken === tokens_1.solToken) {\n    numSigs = 3;\n  } else {\n    numSigs = 2;\n  }\n\n  return params.lamportsPerSignature * numSigs;\n}\n\nvar StablePoolQuoteBuilder = /*#__PURE__*/function () {\n  function StablePoolQuoteBuilder() {\n    _classCallCheck(this, StablePoolQuoteBuilder);\n  }\n\n  _createClass(StablePoolQuoteBuilder, [{\n    key: \"buildQuote\",\n    value: function buildQuote(params, inputTradeAmount) {\n      if (!params.amp) {\n        throw new Error(\"amp param required for stable pool\");\n      }\n\n      return {\n        getRate: function getRate() {\n          return _getRate(inputTradeAmount, params);\n        },\n        getPriceImpact: function getPriceImpact() {\n          return _getPriceImpact(inputTradeAmount, params);\n        },\n        getLPFees: function getLPFees() {\n          return public_1.OrcaU64.fromU64(_getLPFees(inputTradeAmount, params), params.inputToken.scale);\n        },\n        getNetworkFees: function getNetworkFees() {\n          return public_1.OrcaU64.fromNumber(_getNetworkFees(params));\n        },\n        getExpectedOutputAmount: function getExpectedOutputAmount() {\n          return public_1.OrcaU64.fromU64(_getExpectedOutputAmount(inputTradeAmount, params), params.outputToken.scale);\n        },\n        getMinOutputAmount: function getMinOutputAmount() {\n          return public_1.OrcaU64.fromU64(getMinimumAmountOut(inputTradeAmount, params), params.outputToken.scale);\n        }\n      };\n    }\n  }]);\n\n  return StablePoolQuoteBuilder;\n}();\n\nexports.StablePoolQuoteBuilder = StablePoolQuoteBuilder;","map":{"version":3,"sources":["/Users/mikovainio/FyFy/token-swap/node_modules/@orca-so/sdk/dist/model/quote/stable-quote.js"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","StablePoolQuoteBuilder","spl_token_1","require","decimal_js_1","stablecurve_1","public_1","tokens_1","getInputAmountLessFees","inputTradeAmount","params","sub","getLPFees","getOutputAmountWithNoSlippage","inputTradeAmountLessFees","inputTokenCount","outputTokenCount","amp","poolInputAmount","poolOutputAmount","computeBaseOutputAmount","getOutputAmount","computeOutputAmount","getExpectedOutputAmountWithNoSlippage","getExpectedOutputAmount","getRate","inputTradeAmountU64","eq","ZERO","default","expectedOutputAmountU64","DecimalUtil","fromU64","inputToken","scale","outputTradeAmount","outputToken","div","toDecimalPlaces","getPriceImpact","noSlippageOutputCountU64","outputCountU64","noSlippageOutputCount","outputCount","impact","mul","feeStructure","tradingFee","traderFee","numerator","denominator","ownerFee","u64","add","toString","getMinimumAmountOut","slippageTolerance","expectedOutputAmount","getNetworkFees","numSigs","solToken","lamportsPerSignature","Error","OrcaU64","fromNumber","getMinOutputAmount"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.StablePoolQuoteBuilder = void 0;\nconst spl_token_1 = require(\"@solana/spl-token\");\nconst decimal_js_1 = __importDefault(require(\"decimal.js\"));\nconst stablecurve_1 = require(\"@orca-so/stablecurve\");\nconst public_1 = require(\"../../public\");\nconst tokens_1 = require(\"../../constants/tokens\");\nfunction getInputAmountLessFees(inputTradeAmount, params) {\n    return inputTradeAmount.sub(getLPFees(inputTradeAmount, params));\n}\nfunction getOutputAmountWithNoSlippage(inputTradeAmountLessFees, params) {\n    const [poolInputAmount, poolOutputAmount, amp] = [\n        params.inputTokenCount,\n        params.outputTokenCount,\n        params.amp,\n    ];\n    return (0, stablecurve_1.computeBaseOutputAmount)(inputTradeAmountLessFees, poolInputAmount, poolOutputAmount, amp);\n}\nfunction getOutputAmount(inputTradeAmountLessFees, params) {\n    const [poolInputAmount, poolOutputAmount, amp] = [\n        params.inputTokenCount,\n        params.outputTokenCount,\n        params.amp,\n    ];\n    return (0, stablecurve_1.computeOutputAmount)(inputTradeAmountLessFees, poolInputAmount, poolOutputAmount, amp);\n}\nfunction getExpectedOutputAmountWithNoSlippage(inputTradeAmount, params) {\n    const inputTradeAmountLessFees = getInputAmountLessFees(inputTradeAmount, params);\n    return getOutputAmountWithNoSlippage(inputTradeAmountLessFees, params);\n}\nfunction getExpectedOutputAmount(inputTradeAmount, params) {\n    const inputTradeAmountLessFees = getInputAmountLessFees(inputTradeAmount, params);\n    return getOutputAmount(inputTradeAmountLessFees, params);\n}\nfunction getRate(inputTradeAmountU64, params) {\n    if (inputTradeAmountU64.eq(public_1.ZERO)) {\n        return new decimal_js_1.default(0);\n    }\n    const expectedOutputAmountU64 = getExpectedOutputAmount(inputTradeAmountU64, params);\n    const inputTradeAmount = public_1.DecimalUtil.fromU64(inputTradeAmountU64, params.inputToken.scale);\n    const outputTradeAmount = public_1.DecimalUtil.fromU64(expectedOutputAmountU64, params.outputToken.scale);\n    return outputTradeAmount.div(inputTradeAmount).toDecimalPlaces(params.outputToken.scale);\n}\nfunction getPriceImpact(inputTradeAmount, params) {\n    if (inputTradeAmount.eq(public_1.ZERO) ||\n        params.inputTokenCount.eq(public_1.ZERO) ||\n        params.outputTokenCount.eq(public_1.ZERO)) {\n        return new decimal_js_1.default(0);\n    }\n    const noSlippageOutputCountU64 = getExpectedOutputAmountWithNoSlippage(inputTradeAmount, params);\n    const outputCountU64 = getExpectedOutputAmount(inputTradeAmount, params);\n    const noSlippageOutputCount = public_1.DecimalUtil.fromU64(noSlippageOutputCountU64, params.outputToken.scale);\n    const outputCount = public_1.DecimalUtil.fromU64(outputCountU64, params.outputToken.scale);\n    const impact = noSlippageOutputCount.sub(outputCount).div(noSlippageOutputCount);\n    return impact.mul(100).toDecimalPlaces(params.outputToken.scale);\n}\nfunction getLPFees(inputTradeAmount, params) {\n    const { feeStructure } = params;\n    const tradingFee = feeStructure.traderFee.numerator === public_1.ZERO\n        ? public_1.ZERO\n        : inputTradeAmount\n            .mul(feeStructure.traderFee.numerator)\n            .div(feeStructure.traderFee.denominator);\n    const ownerFee = feeStructure.ownerFee.numerator === public_1.ZERO\n        ? public_1.ZERO\n        : inputTradeAmount\n            .mul(feeStructure.ownerFee.numerator)\n            .div(feeStructure.ownerFee.denominator);\n    return new spl_token_1.u64(tradingFee.add(ownerFee).toString());\n}\nfunction getMinimumAmountOut(inputTradeAmount, params) {\n    const slippageTolerance = params.slippageTolerance;\n    const expectedOutputAmount = getExpectedOutputAmount(inputTradeAmount, params);\n    return expectedOutputAmount\n        .mul(slippageTolerance.denominator.sub(slippageTolerance.numerator))\n        .div(slippageTolerance.denominator);\n}\nfunction getNetworkFees(params) {\n    let numSigs;\n    if (params.inputToken === tokens_1.solToken || params.outputToken === tokens_1.solToken) {\n        numSigs = 3;\n    }\n    else {\n        numSigs = 2;\n    }\n    return params.lamportsPerSignature * numSigs;\n}\nclass StablePoolQuoteBuilder {\n    buildQuote(params, inputTradeAmount) {\n        if (!params.amp) {\n            throw new Error(\"amp param required for stable pool\");\n        }\n        return {\n            getRate: () => getRate(inputTradeAmount, params),\n            getPriceImpact: () => getPriceImpact(inputTradeAmount, params),\n            getLPFees: () => public_1.OrcaU64.fromU64(getLPFees(inputTradeAmount, params), params.inputToken.scale),\n            getNetworkFees: () => public_1.OrcaU64.fromNumber(getNetworkFees(params)),\n            getExpectedOutputAmount: () => public_1.OrcaU64.fromU64(getExpectedOutputAmount(inputTradeAmount, params), params.outputToken.scale),\n            getMinOutputAmount: () => public_1.OrcaU64.fromU64(getMinimumAmountOut(inputTradeAmount, params), params.outputToken.scale),\n        };\n    }\n}\nexports.StablePoolQuoteBuilder = StablePoolQuoteBuilder;\n"]},"metadata":{},"sourceType":"script"}